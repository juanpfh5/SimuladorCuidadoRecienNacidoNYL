<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button routerLink="/home" fill="clear">
        <strong><</strong>
      </ion-button>
    </ion-buttons>

    <ion-title>Dormir</ion-title>

    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="openInfo($event)" title="InformaciÃ³n de la actividad">
        <!-- <ion-icon slot="icon-only" name="information-circle-outline"></ion-icon> -->
         <strong>(?)</strong>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="dormir-page" (pointermove)="moveDrag($event)" (pointerup)="endDrag($event)" (pointercancel)="endDrag($event)">

  <!-- Background decorative shapes (like BaÃ±ar) -->
  <div class="falling-area" aria-hidden="true">
    <div class="drop d1"></div>
    <div class="drop d2"></div>
    <div class="drop d3"></div>
    <div class="drop d4"></div>
    <div class="drop d5"></div>
  </div>

  <div class="center-wrap">
    <div class="card">
      <h1 class="page-title">Dormir</h1>
      <p class="subtitle">Prepara un ambiente tranquilo y arrulla al bebÃ©.</p>

      <!-- Progress bar inside card -->
      <div class="progress-container">
        <div class="progress-bar" [style.width.%]="progress"></div>
      </div>

      <div class="scene">

        <!-- Ãrea del bebÃ© (click + arrullar) -->
        <div id="baby-area"
             class="baby-area"
             (click)="onBabyClick()"
             (pointerdown)="startRock($event)"
             (pointerup)="stopRock()">

          <img [src]="babyImg"
               class="baby-img"
               [class.rocking]="isRocking">
        </div>

        <!-- Herramientas (cobija, chupon y luz) -->
        <div class="tools">
          <img #draggable src="assets/imgs/dormir/Cobija.png" data-name="cobija" class="tool"
            (pointerdown)="startDrag($event, $event.currentTarget)">
          <img #draggable src="assets/imgs/dormir/Chupon.png" data-name="chupon" class="tool"
            (pointerdown)="startDrag($event, $event.currentTarget)">
          <img #draggable src="assets/imgs/dormir/Luz.png" data-name="luz" class="tool light-btn" (pointerdown)="startDrag($event, $event.currentTarget)" (click)="toggleLight()">
        </div>

      </div>

      <!-- <div class="debug-controls" style="padding:6px; text-align:center;">
        <ion-button size="small" color="secondary" (click)="completarActividad()">Enviar POST de prueba</ion-button>
      </div> -->

    </div>
  </div>

  <!-- Night overlay when light off -->
  <div class="night-overlay" *ngIf="lightOff"></div>

  <!-- Inline info overlay: visible on APK where Popover may fail -->
  <div class="info-overlay" *ngIf="showInfo">
    <div class="info-card">
      <div class="info-header" style="color: black;">
        <h3>Instrucciones</h3>
        <button class="close-btn" (click)="closeInfo()">âœ•</button>
      </div>
      <div class="info-body">
        <ol>
          <li *ngFor="let s of infoSteps">{{ s }}</li>
        </ol>
      </div>
      <div class="info-actions">
        <ion-button expand="block" (click)="closeInfo()" class="enter-btn">Cerrar</ion-button>
      </div>
    </div>
  </div>

  <!-- Done message: fixed to bottom like BaÃ±ar -->
  <div *ngIf="completed" class="done-msg">Â¡El bebÃ© estÃ¡ durmiendo! ğŸ˜´</div>

</ion-content>
